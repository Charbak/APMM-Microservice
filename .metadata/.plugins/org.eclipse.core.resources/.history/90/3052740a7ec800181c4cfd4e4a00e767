package com.example.demo;

import java.util.Date;

import org.springframework.amqp.rabbit.annotation.RabbitHandler;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.messaging.handler.annotation.Payload;

import com.datastax.driver.core.utils.UUIDs;
import com.example.demo.dao.CustomerRepository;
import com.example.demo.dao.EmployeeRepository;
import com.example.demo.model.Customer;
import com.example.demo.model.Employee;

@SpringBootApplication
@RabbitListener(queues="${javainuse.rabbitmq.queue}", containerFactory="jsaFactory")
public class SpringBootRabbitMqApplication {
	
	@Autowired
	private EmployeeRepository repository;
	
	@RabbitHandler
	public void process(@Payload Employee employee) {
		System.out.println(new Date() + "Message Received: " + employee  );
		
		//deleting existing records
				System.out.println("Deleted existing records by calling deleteAll()");
				System.out.println("------------------------------------");
				this.repository.deleteAll();

				// save a couple of customers
				System.out.println("Inserting records by calling save()");
				System.out.println("------------------------------------");
				this.repository.save(new Employee(employee.getId(), employee.getFirstName(), employee.getLastName()));
				

				// fetch all customers
				System.out.println("Customers found with findAll():");
				System.out.println("-------------------------------");
				for (Employee customer : this.repository.findAll()) {
					System.out.println(customer);
				}
				System.out.println();

				// fetch an individual customer
				System.out.println("Customer found with findByFirstName('Antara'):");
				System.out.println("--------------------------------");
				System.out.println(this.repository.findByFirstName(employee.getFirstName()));

				System.out.println("Customers found with findByLastName('Dey'):");
				System.out.println("--------------------------------");
				for (Employee customer : this.repository.findByLastName(employee.getLastName())) {
					System.out.println(customer);
				}
		
	}

	public static void main(String[] args) {
		SpringApplication.run(SpringBootRabbitMqApplication.class, args);
	}
}
